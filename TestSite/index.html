<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cricket Nets Duel</title>

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom, #000000 0%, #003300 100%);
        color: white;
    }

    #app {
        height: calc(100vh - 50px);
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        align-items: center;
        text-align: center;
        padding: 5px 0;
        box-sizing: border-box;
    }

    h1 {
        font-size: 7vw;
        color: #00eaff;
        text-shadow: 0 0 12px #00eaff, 0 0 25px #00eaff;
        margin: 0;
        animation: pulse 2.5s infinite ease-in-out;
    }

    @keyframes pulse {
        0% { text-shadow: 0 0 10px #00eaff; }
        50% { text-shadow: 0 0 25px #00eaff; }
        100% { text-shadow: 0 0 10px #00eaff; }
    }

    .btn, .pillBtn {
        border: none;
        cursor: pointer;
        transition: 0.15s;
        color: white;
        background: #111;
        box-shadow: 0 0 12px #00eaff inset, 0 0 12px #00eaff;
    }

    .pillBtn {
        width: 85vw;
        padding: 1.6vh 0;
        font-size: 4.5vw;
        border-radius: 50px;
    }

    .btn {
        width: 85vw;
        padding: 1.8vh 0;
        font-size: 5vw;
        border-radius: 12px;
        margin: 5px 0;
    }

    .btnRed {
        background: #aa0000;
        box-shadow: 0 0 14px #ff4444 inset, 0 0 18px #ff4444;
    }

    .sectionLabel {
        font-size: 5vw;
        color: #88ff88;
        text-shadow: 0 0 8px #00ff55;
        margin-bottom: 5px;
    }

    input {
        width: 80vw;
        padding: 12px;
        font-size: 4.5vw;
        border-radius: 10px;
        border: none;
        outline: none;
        margin-bottom: 10px;
        text-align: center;
    }

    #scenarioBox {
        width: 90vw;
        min-height: 20vh;
        max-height: 28vh;
        overflow-y: auto;
        background: #222;
        border-radius: 12px;
        padding: 20px;
        font-size: 4.8vw;
        line-height: 1.45;
        box-shadow: 0 0 10px #444 inset;
        opacity: 0;
        transition: opacity 0.4s ease-in-out;
    }

    #scoreboard {
        font-size: 5vw;
        margin-top: 10px;
        color: #00ffcc;
        text-shadow: 0 0 10px #00ffcc;
    }

    #switchScreen h2,
    #finalScreen h2 {
        font-size: 6vw;
        margin-bottom: 10px;
    }

    #switchText,
    #finalText {
        font-size: 4.5vw;
        line-height: 1.4;
        margin-bottom: 15px;
    }

    #adBanner {
        width: 100%;
        height: 50px;
        background: #111;
        opacity: 0.8;
        font-size: 3.5vw;
        text-align: center;
        line-height: 50px;
        position: absolute;
        bottom: 0;
        left: 0;
    }
</style>
</head>

<body>

<div id="app">

    <h1>Cricket Nets Duel</h1>

    <div style="width:85vw; font-size:4vw; color:#ccffcc; margin-bottom:10px;">
        <b>Rules:</b><br>
        Each ball the bowler and batsman are set targets.
        Players decide who met their targets, the bowler updates the score.
        If both players meet targets hit TIE.
        If the bowler fails to hit their target the point goes to the batsman (they are denied the chance to hit their target).
        Once no balls remain SWITCH ROLES. The batter bowls & vice-versa.
        The scoreboard GOES HIDDEN in the second innings for suspense.<br>
        <b>GOOD LUCK!</b>
    </div>

    <!-- SETUP SCREEN -->
    <div id="setupScreen">

        <div class="sectionLabel">Player Names</div>
        <input id="p1" placeholder="Player A">
        <input id="p2" placeholder="Player B">

        <div class="sectionLabel">Balls Per Innings</div>
        <button class="btn" onclick="setBalls(20)">20 Balls</button>
        <button class="btn" onclick="setBalls(40)">40 Balls</button>
        <button class="btn" onclick="setBalls(60)">60 Balls</button>

        <button class="btnRed" style="margin-top:15px;" onclick="startDuel()">Start Duel</button>
    </div>

    <!-- DUEL SCREEN -->
    <div id="duelScreen" style="display:none;">
        <div id="ballCount" class="sectionLabel"></div>

        <div id="scenarioBox">Scenario will appear here.</div>

        <button class="btn" onclick="scorePoint('bowler')">Bowler Wins</button>
        <button class="btn" onclick="scorePoint('batter')">Batter Wins</button>
        <button class="btn" onclick="scorePoint('tie')">Tie</button>

        <div id="scoreboard"></div>

        <div style="height:10px;"></div>

        <button class="pillBtn" onclick="window.location.href='https://www.gyradio.com/TestSite/bowling'">
            Bowling Practice
        </button>
    </div>

    <!-- SWITCH ROLES SCREEN -->
    <div id="switchScreen" style="display:none;">
        <h2>Switch Roles!</h2>
        <p id="switchText"></p>
        <button class="btnRed" onclick="startInnings2()">Start Innings 2</button>
    </div>

    <!-- FINAL RESULTS SCREEN -->
    <div id="finalScreen" style="display:none;">
        <h2>Final Results</h2>
        <div id="finalText"></div>
        <button class="btn" onclick="location.reload()">Play Again</button>
    </div>

</div>

<div id="adBanner">Ad banner goes here</div>

<script>
/* WAKE LOCK â€” robust */
let wakeLock = null;

async function requestWakeLock() {
    try {
        wakeLock = await navigator.wakeLock.request("screen");
        wakeLock.addEventListener("release", () => {
            requestWakeLock();
        });
    } catch (err) {
        console.log("Wake lock error:", err);
    }
}

document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
        requestWakeLock();
    }
});

/* SPEECH SYNTHESIS */
function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 1;
    utter.pitch = 1;
    utter.volume = 1;

    const voices = speechSynthesis.getVoices();
    const preferred = voices.find(v =>
        v.name.toLowerCase().includes("male") ||
        v.name.toLowerCase().includes("deep") ||
        v.name.toLowerCase().includes("english")
    );
    if (preferred) utter.voice = preferred;

    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
}

/* GAME STATE */
let balls = 0;
let ballsLeft = 0;

let playerA = "Player A";
let playerB = "Player B";

let innings = 1;

let scoreA = 0;
let scoreB = 0;
let ties = 0;

let currentBowler = null;
let currentBatter = null;

const scenarios = [
    { bowler: "Aim for the top of off stump.", batter: "Play a defensive shot." },
    { bowler: "Bowl a slower ball.", batter: "Try to hit straight down the ground." },
    { bowler: "Bowl wide of off stump.", batter: "Leave the ball." },
    { bowler: "Bowl a yorker.", batter: "Try to dig it out safely." },
    { bowler: "Bowl short.", batter: "Play a controlled pull shot." }
];

function setBalls(n) {
    balls = n;
}

function startDuel() {
    requestWakeLock();

    playerA = document.getElementById("p1").value || "Player A";
    playerB = document.getElementById("p2").value || "Player B";

    if (!balls) balls = 20;
    ballsLeft = balls;

    // Randomise who bowls/bats first
    if (Math.random() < 0.5) {
        currentBowler = playerA;
        currentBatter = playerB;
    } else {
        currentBowler = playerB;
        currentBatter = playerA;
    }

    document.getElementById("setupScreen").style.display = "none";
    document.getElementById("duelScreen").style.display = "block";

    updateBallCount();
    generateScenario();
    updateScoreboard();
}

function updateBallCount() {
    document.getElementById("ballCount").innerText =
        `Balls Remaining: ${ballsLeft}`;
}

function generateScenario() {
    const box = document.getElementById("scenarioBox");
    box.style.opacity = 0;

    setTimeout(() => {
        const s = scenarios[Math.floor(Math.random() * scenarios.length)];
        const text = `Bowler: ${s.bowler}. Batter: ${s.batter}.`;

        box.innerHTML =
            `<b>Bowler:</b> ${s.bowler}<br><br><b>Batter:</b> ${s.batter}`;
        box.style.opacity = 1;

        speak(text);
    }, 200);
}

function scorePoint(winner) {
    if (innings === 1) {
        if (winner === "bowler") {
            // bowler is whoever is bowling this innings
            if (currentBowler === playerA) scoreA++; else scoreB++;
        }
        if (winner === "batter") {
            if (currentBatter === playerA) scoreA++; else scoreB++;
        }
        if (winner === "tie") ties++;
    } else {
        // innings 2: roles swapped, but we still track by player
        if (winner === "bowler") {
            if (currentBowler === playerA) scoreA++; else scoreB++;
        }
        if (winner === "batter") {
            if (currentBatter === playerA) scoreA++; else scoreB++;
        }
        if (winner === "tie") ties++;
    }

    ballsLeft--;

    if (ballsLeft <= 0) {
        if (innings === 1) {
            switchRoles();
        } else {
            endDuel();
        }
        return;
    }

    updateBallCount();
    generateScenario();
    updateScoreboard();
}

function updateScoreboard() {
    if (innings === 1) {
        document.getElementById("scoreboard").innerHTML =
            `${playerA}: ${scoreA} | ${playerB}: ${scoreB} | Ties: ${ties}`;
    } else {
        document.getElementById("scoreboard").innerHTML = "";
    }
}

function switchRoles() {
    innings = 2;
    ballsLeft = balls;

    // Swap roles
    const oldBowler = currentBowler;
    currentBowler = currentBatter;
    currentBatter = oldBowler;

    document.getElementById("duelScreen").style.display = "none";
    document.getElementById("switchScreen").style.display = "block";

    document.getElementById("switchText").innerText =
        `${currentBowler} now bowls. ${currentBatter} now bats.`;
}

function startInnings2() {
    document.getElementById("switchScreen").style.display = "none";
    document.getElementById("duelScreen").style.display = "block";

    updateBallCount();
    generateScenario();
}

function endDuel() {
    document.getElementById("duelScreen").style.display = "none";
    document.getElementById("finalScreen").style.display = "block";

    let winner = "It's a tie!";
    if (scoreA > scoreB) winner = `${playerA} wins!`;
    if (scoreB > scoreA) winner = `${playerB} wins!`;

    document.getElementById("finalText").innerHTML =
        `<b>${playerA}:</b> ${scoreA}<br>
         <b>${playerB}:</b> ${scoreB}<br>
         <b>Ties:</b> ${ties}<br><br>
         <h3>${winner}</h3>`;
}
</script>

</body>
</html>



